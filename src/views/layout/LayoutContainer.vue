<script setup>
import {ref,onMounted} from "vue";
import {useUserStore} from "@/stores";
import {getUserInfoService} from "@/api/Contacts.js";
import UserInformationPopWindow from "@/components/UserInformationPopWindow.vue";
const userStore = useUserStore()
onMounted(() => {
  userStore.getUser();

  getUserInfo();

  // 1. 读取并应用持久化的主题
  const storedTheme = userStore.getMyTheme(); // 注意是字符串
  changeTheme(storedTheme);  // 恢复上次的主题样式

  //设置类名
  document.querySelector('.layout-container').classList.add('blue-theme')
})

// 当前选择的主题名
// 获取当前主题
let selectedTheme = userStore.getMyTheme();  // 注意这里加 ()


function changeTheme(themeName) {
  selectedTheme = themeName;

  document.body.className = ''; // 清除旧的主题类
  if (selectedTheme !== 'default') {
    document.body.classList.add(`${selectedTheme}-theme`);
  }
  userStore.setMyTheme(selectedTheme); // 存储主题设置
}

const isDisplay = ref(false)
const userInfo = ref({
  userId: 1,
  email: '',
  username: '',
  status: 1,
  gender: 1,
  signature: '',
  logo: '',
})
const getUserInfo = async () => {

  const res = await getUserInfoService();
  userInfo.value = res.data.data;

}

</script>

<template>
  <el-container class="layout-container">
    <el-aside width="100px">
      <div class="user-logo">
        <img :src="userInfo.logo" alt="" @click=" isDisplay = !isDisplay" />
      </div>
      <el-menu
          :default-active="$route.path"
          router
      >
        <el-menu-item index="/main/alonechat">
          <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4504" width="200" height="200"><path d="M355.76 85.68A175.808 175.808 0 0 1 496 16c67.616 0 126.368 38.208 155.84 94.192a31.712 31.712 0 0 0 47.872 9.744C731.712 94.736 772.144 80 816 80c105.968 0 192 86.032 192 192s-86.032 192-192 192c-93.36 0-171.232-66.768-188.448-155.12a175.632 175.632 0 0 1-140.144 58.912C459.44 469.328 366.368 544 256 544 123.536 544 16 436.464 16 304S123.536 64 256 64c35.584 0 69.376 7.76 99.76 21.68z" fill="#CBE9EA" p-id="4505"></path><path d="M16 400.8A128.864 128.864 0 0 1 144.8 272h734.4A128.864 128.864 0 0 1 1008 400.8v305.6a128.864 128.864 0 0 1-128.8 128.8h-161.6L809.6 1008 568.8 835.2H144.8A128.864 128.864 0 0 1 16 706.4v-305.6z" fill="#FFD140" p-id="4506"></path><path d="M144.8 835.2c-21.408 0 459.952-30.704 678.288-44.56A112 112 0 0 0 928 678.864V412.064a144 144 0 0 0-42.688-102.32L847.2 272C918.288 272 1008 329.712 1008 400.8v305.6a128.864 128.864 0 0 1-128.8 128.8h-161.6L809.6 1008 568.8 835.2H144.8z" fill="#D9B236" p-id="4507"></path><path d="M288 552m-56 0a56 56 0 1 0 112 0 56 56 0 1 0-112 0Z" fill="#FFFFFF" p-id="4508"></path><path d="M288 552m-56 0a56 56 0 1 0 112 0 56 56 0 1 0-112 0Z" fill="#FFFFFF" p-id="4509"></path><path d="M512 552m-56 0a56 56 0 1 0 112 0 56 56 0 1 0-112 0Z" fill="#FFFFFF" p-id="4510"></path><path d="M736 552m-56 0a56 56 0 1 0 112 0 56 56 0 1 0-112 0Z" fill="#FFFFFF" p-id="4511"></path><path d="M585.616 225.312A120.064 120.064 0 0 1 472 384a119.408 119.408 0 0 1-74.272-25.776A144.048 144.048 0 0 1 272 432c-79.472 0-144-64.528-144-144 0-26.224 7.024-50.832 19.296-72.016" fill="#CBE9EA" p-id="4512"></path><path d="M585.616 225.312c3.264-12.4 6.384 25.152 6.384 38.688 0 66.224-53.776 120-120 120a119.408 119.408 0 0 1-74.272-25.776A144.048 144.048 0 0 1 272 432c-79.472 0-144-64.528-144-144 0-26.224 17.84-96.464 19.296-72.016 10.784 179.808 167.712 183.392 250.432 94.992 67.824 66.656 166.24-3.392 187.888-85.664z" fill="#ADC6C7" p-id="4513"></path></svg>
          <el-badge  is-dot class="badgeItem" :offset="[2, 16]" >
            <span>单聊</span>
          </el-badge>
        </el-menu-item>
        <el-menu-item index="/main/groupchat">
          <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1313" width="200" height="200">
            <path d="M217.9 356.5c-14.1 0-25.5 11.4-25.5 25.5s11.4 25.5 25.5 25.5 25.5-11.4 25.5-25.5-11.4-25.5-25.5-25.5zM217.4 433.7c-11.2 0-20.4 9.2-20.4 20.4v174.4c0 11.2 9.2 20.4 20.4 20.4s20.4-9.2 20.4-20.4V454.1c0-11.2-9.2-20.4-20.4-20.4z" fill="#6B400D" p-id="1314"></path>
            <path d="M878.7 379.5v-86c0-96.3-57.5-153.7-153.7-153.7H218c-96.3 0-153.7 57.5-153.7 153.7v320.7C64.3 710.5 121.8 768 218 768h45.8v120.4L449.9 768h11.2c17.2 11.3 39 17.5 64.6 17.5h161.6l130.7 85v-85.1h33.5c66.6 0 107.9-41.3 107.9-107.9V484.8c-0.1-56.9-30.3-95.3-80.7-105.3zM417.8 484.8v192.8c0 16.2 2.5 31 7.2 44l-106.1 70.1v-74.9h-101c-67.7-0.3-102.2-34.8-102.5-102.5V293.5c0.3-67.7 34.8-102.2 102.5-102.5H725c67.7 0.3 102.2 34.8 102.5 102.5v83.3H525.7c-66.5 0.1-107.9 41.4-107.9 108z m490.4 192.7c-0.2 38.6-18.2 56.6-56.7 56.7h-87.2v40.3l-61-40.3H525.7c-38.5-0.2-56.6-18.2-56.7-56.7V484.8c0.2-38.6 18.2-56.6 56.7-56.7h325.7c38.5 0.2 56.6 18.2 56.7 56.7v192.7z" fill="#6B400D" p-id="1315"></path>
            <path d="M851.4 428.1H525.7c-38.5 0.2-56.6 18.2-56.7 56.7v192.8c0.2 38.5 18.2 56.6 56.7 56.7h177.5l61 40.3v-40.3h87.2c38.5-0.2 56.6-18.2 56.7-56.7V484.8c-0.1-38.6-18.1-56.6-56.7-56.7zM567 627.4c-21.1 0-38.3-17.2-38.3-38.3 0-21.1 17.2-38.3 38.3-38.3 21.1 0 38.3 17.2 38.3 38.3 0 21.1-17.2 38.3-38.3 38.3z m122.2 0c-21.1 0-38.3-17.2-38.3-38.3 0-21.1 17.2-38.3 38.3-38.3 21.1 0 38.3 17.2 38.3 38.3 0 21.1-17.2 38.3-38.3 38.3z m122.3 0c-21.1 0-38.3-17.2-38.3-38.3 0-21.1 17.2-38.3 38.3-38.3 21.1 0 38.3 17.2 38.3 38.3 0 21.1-17.2 38.3-38.3 38.3z" fill="#FFD524" p-id="1316"></path>
            <path d="M567 550.8c-21.1 0-38.3 17.2-38.3 38.3 0 21.1 17.2 38.3 38.3 38.3 21.1 0 38.3-17.2 38.3-38.3 0-21.1-17.2-38.3-38.3-38.3zM689.2 550.8c-21.1 0-38.3 17.2-38.3 38.3 0 21.1 17.2 38.3 38.3 38.3 21.1 0 38.3-17.2 38.3-38.3 0-21.1-17.2-38.3-38.3-38.3zM811.5 550.8c-21.1 0-38.3 17.2-38.3 38.3 0 21.1 17.2 38.3 38.3 38.3 21.1 0 38.3-17.2 38.3-38.3 0-21.1-17.2-38.3-38.3-38.3z" fill="#6B400D" p-id="1317"></path>
          </svg>
          <el-badge  is-dot class="badgeItem" :offset="[2, 16]" >
            <span>群聊</span>
          </el-badge>
        </el-menu-item>
        <el-menu-item index="/main/contacts">
          <svg  class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1097" width="200" height="200"><path d="M300.032 387.712a102.101333 102.101333 0 1 1 204.202667 0 102.101333 102.101333 0 0 1-204.202667 0z m102.101333-46.634667a46.634667 46.634667 0 1 0 0 93.269334 46.634667 46.634667 0 0 0 0-93.269334zM388.693333 558.848a165.973333 165.973333 0 0 0-162.901333 134.272l-4.352 22.357333a27.733333 27.733333 0 1 0 54.442667 10.581334l4.309333-22.357334a110.506667 110.506667 0 0 1 108.501333-89.386666h30.208a110.506667 110.506667 0 0 1 108.458667 89.386666l4.352 22.357334a27.733333 27.733333 0 0 0 54.442667-10.581334l-4.352-22.357333a165.973333 165.973333 0 0 0-162.901334-134.272H388.693333z" p-id="1098"></path><path d="M750.634667 898.133333a155.605333 155.605333 0 0 1-131.072 71.68H189.44a155.733333 155.733333 0 0 1-155.733333-155.733333V209.92a155.733333 155.733333 0 0 1 155.733333-155.733333h430.08c57.941333 0 108.501333 31.701333 135.338667 78.677333l127.189333 36.352a92.757333 92.757333 0 0 1 67.285333 89.173333V771.413333c0 41.429333-27.477333 77.824-67.285333 89.173334l-131.456 37.546666zM89.173333 209.92v604.16a100.266667 100.266667 0 0 0 100.266667 100.266667h430.08a100.266667 100.266667 0 0 0 90.88-57.813334l-1.194667-4.181333 3.456-1.024c4.608-11.52 7.168-24.064 7.168-37.248V209.92c0-10.752-1.706667-21.077333-4.821333-30.805333l-3.584-9.386667a100.266667 100.266667 0 0 0-91.861333-60.074667H189.44a100.266667 100.266667 0 0 0-100.266667 100.266667z m684.842667 623.914667l92.842667-26.538667a37.290667 37.290667 0 0 0 27.050666-35.84V258.389333a37.290667 37.290667 0 0 0-27.050666-35.84l-92.16-26.368c0.384 4.522667 0.554667 9.088 0.554666 13.738667v604.16c0 6.698667-0.426667 13.269333-1.237333 19.754667z" p-id="1099"></path></svg>
          <el-badge  is-dot class="badgeItem" :offset="[2, 16]" >
            <span>人脉</span>
          </el-badge>
        </el-menu-item>
        <el-menu-item index="/main/review">
          <svg  class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1241" width="200" height="200"><path d="M321.1264 302.0288a199.9872 199.424 0 1 0 399.9744 0 199.9872 199.424 0 1 0-399.9744 0Z" fill="#FFD833" p-id="1242"></path><path d="M748.544 605.44h-7.8336c-14.1312 0-25.6-11.4688-25.6-25.6s11.4688-25.6 25.6-25.6h7.8336c14.1312 0 25.6 11.4688 25.6 25.6s-11.4688 25.6-25.6 25.6z" fill="#44454A" p-id="1243"></path><path d="M855.2448 839.8848H179.8144c-40.704 0-73.8304-33.1264-73.8304-73.8304v-91.9552c0-66.0992 53.76-119.8592 119.808-119.8592h150.784v-60.416c-61.3888-45.568-97.6384-117.0432-97.6384-193.9456 0-133.2224 108.3904-241.5616 241.5616-241.5616s241.5616 108.3904 241.5616 241.5616c0 79.872-40.2432 155.136-105.9328 199.8848v54.528h8.0896c14.1312 0 25.6 11.4688 25.6 25.6s-11.4688 25.6-25.6 25.6h-33.6896c-14.1312 0-25.6-11.4688-25.6-25.6v-94.208c0-9.0112 4.7616-17.408 12.544-22.016 57.6-34.2016 93.3888-96.9728 93.3888-163.7888 0-104.96-85.4016-190.3616-190.3616-190.3616S330.1376 194.9184 330.1376 299.8784c0 64.3072 32.2048 123.8528 86.0672 159.232a25.6 25.6 0 0 1 11.5712 21.4016v99.328c0 14.1312-11.4688 25.6-25.6 25.6H225.792c-37.8368 0-68.608 30.7712-68.608 68.6592v91.9552c0 12.4928 10.1376 22.6304 22.6304 22.6304h675.4816c12.4928 0 22.6304-10.1376 22.6304-22.6304v-91.9552c0-32.9216-23.3984-61.2864-55.6544-67.4304a25.57952 25.57952 0 0 1-20.3264-29.952 25.60512 25.60512 0 0 1 29.952-20.3264c56.3712 10.752 97.28 60.2624 97.28 117.7088v91.9552c-0.0512 40.704-33.1776 73.8304-73.9328 73.8304zM889.1904 957.1328H146.2784c-14.1312 0-25.6-11.4688-25.6-25.6s11.4688-25.6 25.6-25.6h742.912c14.1312 0 25.6 11.4688 25.6 25.6s-11.4688 25.6-25.6 25.6z" fill="#44454A" p-id="1244"></path></svg>
          <el-badge  is-dot class="badgeItem" :offset="[2, 16]" hidden>
            <span>审核</span>
          </el-badge>
        </el-menu-item>
        <el-menu-item index="/main/settings">
          <svg  class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1390" width="200" height="200"><path d="M732.16 744.0384a69.5808 69.5808 0 0 0-4.608-6.656 258.3552 258.3552 0 0 0 68.1984-120.6784 69.9904 69.9904 0 0 0 8.0896 0.512 64.768 64.768 0 0 0-1.0752-129.4848 72.6016 72.6016 0 0 0-8.192 0.6656 257.1776 257.1776 0 0 0-70.656-120.064 76.8 76.8 0 0 0 4.4544-6.7584 64.768 64.768 0 1 0-112.64-63.6416 68.2496 68.2496 0 0 0-3.4816 7.3216 258.0992 258.0992 0 0 0-138.9568 1.4336 53.504 53.504 0 0 0-3.6352-7.2704A64.7168 64.7168 0 1 0 358.4 365.2608a69.2224 69.2224 0 0 0 4.5568 6.656 258.8672 258.8672 0 0 0-68.4032 120.6784 70.912 70.912 0 0 0-8.1408-0.512 64.768 64.768 0 0 0 1.1264 129.4848 70.7584 70.7584 0 0 0 8.1408-0.6656 258.4064 258.4064 0 0 0 70.656 120.1152 68.9152 68.9152 0 0 0-4.4032 6.7072 64.7168 64.7168 0 1 0 112.64 63.6416 72.448 72.448 0 0 0 3.4816-7.2704 258.56 258.56 0 0 0 138.9568-1.4848 68.7616 68.7616 0 0 0 3.6352 7.2704A64.768 64.768 0 0 0 732.16 744.0384z" fill="#A3A2FF" p-id="1391"></path><path d="M349.952 908.1344a105.728 105.728 0 0 1-94.1056-153.6 359.0656 359.0656 0 0 1-81.92-139.6736 105.6256 105.6256 0 0 1-1.8944-211.0464A361.216 361.216 0 0 1 250.88 263.8336a105.6256 105.6256 0 0 1 181.76-107.52 359.3216 359.3216 0 0 1 161.536-1.7408 105.6256 105.6256 0 0 1 184.7808 101.7856 268.0832 268.0832 0 0 1 82.7392 141.6704 105.6256 105.6256 0 0 1 0.4096 210.9952 361.216 361.216 0 0 1-79.2576 140.1856 105.6256 105.6256 0 0 1-181.76 107.52 359.3216 359.3216 0 0 1-161.536 1.7408 105.1648 105.1648 0 0 1-61.44 45.7728 106.6496 106.6496 0 0 1-28.16 3.8912zM188.8256 573.44a20.48 20.48 0 0 1 19.7632 15.36 318.8224 318.8224 0 0 0 87.3472 148.48 20.48 20.48 0 0 1 2.304 26.9824 58.3168 58.3168 0 0 0-4.4544 6.7584 64.6656 64.6656 0 0 0 112.64 63.5392 60.9792 60.9792 0 0 0 3.4816-7.2704 20.48 20.48 0 0 1 24.2688-12.032 318.6688 318.6688 0 0 0 171.7248-1.8432 20.48 20.48 0 0 1 24.5248 11.5712 75.0592 75.0592 0 0 0 3.6352 7.3216 64.7168 64.7168 0 0 0 111.4112-65.792 74.5984 74.5984 0 0 0-4.6592-6.7072 20.48 20.48 0 0 1 1.7408-26.9824A319.0784 319.0784 0 0 0 826.88 583.68a20.48 20.48 0 0 1 22.2208-15.36c3.1744 0.3584 5.7344 0.4608 8.1408 0.512a64.7168 64.7168 0 0 0-0.5632-129.3824h-0.5632a76.1344 76.1344 0 0 0-8.1408 0.6656 20.48 20.48 0 0 1-22.9376-16.896c-16.64-98.6624-81.2544-142.3872-84.0192-144.2304a20.48 20.48 0 0 1-5.12-29.2864 63.0784 63.0784 0 0 0 4.4544-6.7584 64.6656 64.6656 0 1 0-112.64-63.5392 62.3616 62.3616 0 0 0-3.4816 7.3216 20.48 20.48 0 0 1-24.2688 11.9296 319.1296 319.1296 0 0 0-171.7248 1.8432 20.48 20.48 0 0 1-24.5248-11.52 60.8768 60.8768 0 0 0-3.6352-7.3216 64.6656 64.6656 0 1 0-111.4624 65.4336 58.9312 58.9312 0 0 0 4.608 6.656 20.48 20.48 0 0 1-1.7408 27.0336A319.0784 319.0784 0 0 0 207.1552 430.08a20.48 20.48 0 0 1-22.2208 15.36 61.7472 61.7472 0 0 0-8.1408-0.512 64.7168 64.7168 0 0 0 0.5632 129.3824h0.5632a75.1104 75.1104 0 0 0 8.1408-0.6656 16.7424 16.7424 0 0 1 2.7648-0.2048z" fill="#55524F" p-id="1392"></path><path d="M516.7616 669.696a163.072 163.072 0 1 1 142.1824-82.9952 163.328 163.328 0 0 1-142.1824 82.9952z m0.3584-285.1328a123.392 123.392 0 0 0-32.9728 4.5568 122.0096 122.0096 0 1 0 139.0592 177.4592A122.1632 122.1632 0 0 0 517.12 384.5632z" fill="#55524F" p-id="1393"></path></svg>
          <span>设置</span>
        </el-menu-item>
      </el-menu>
    </el-aside>
    <el-container>
      <el-main>
        <router-view></router-view>
      </el-main>
    </el-container>

    <!-- 将弹窗组件放在布局容器外部，使其可以定位到页面中央 -->
    <div
        v-if="isDisplay"
        class="popup-overlay"
        @click="isDisplay = false"
    >
      <div class="popup-content" @click.stop>
        <UserInformationPopWindow :userInfo="userInfo" />
      </div>
    </div>

  </el-container>
</template>

<style lang="scss" scoped>

.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.layout-container {
  position: relative;
  height: 100vh;
  padding: 10px 10px 10px 0;
  background-color: var(--mainBackground);
  .el-aside {
    background-color: var(--mainBackground);
    width: 90px;
    .user-logo{
      margin: 10px auto auto;
      width: 65px;
      height: 65px;
      border-radius: 50%;
      background-color: antiquewhite;

      img{
        width: 100%;
        height: 100%;
        border-radius: 50%;
      }

    }
    .el-menu {
      margin-top: 40px;
      border-right: none;
      height: 80%;
      background-color: var(--mainBackground);
      active-text-color: var(--mainButtonHover);
      position: relative; /* 关键：为绝对定位提供参考 */
      min-height: 300px; /* 可选：确保容器有一定高度 */
      .el-menu-item {
        width: 65px;
        height: 40px;
        color: var(--mainText);
        padding: 2px;
        margin: 20px 12px 12px;
        border-radius: 10px;
        text-align: center;

        .icon {
          width: 2em;
          height: 2em;
          vertical-align: -0.15em;
          fill: currentColor;
          overflow: hidden;
        }
      }
      .el-menu-item:hover {
        background-color: var(--mainButtonHover);
        color: yellow;

      }
      .el-menu-item.is-active {
        color: yellow;
      }
      .el-menu-item:last-child {
        position: absolute;
        bottom: 0;
        text-align: center;
      }
    }
  }
  .el-main{
    padding: 0;
    height: 100%;
    width: 100%;
    background-color: var(--showBackground);
    border-radius: 10px;
  }

}
</style>
